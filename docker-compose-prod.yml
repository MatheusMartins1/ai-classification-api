# Docker Compose configuration for Image Metadata API
# Developer: Matheus Martins da Silva
# Creation Date: 11/2025

version: '3.8'

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    image: ai-regression-api
    container_name: ai-regression-api-prod
    ports:
      - "${PORT:-8345}:${PORT:-8345}"
    env_file:
      - .env.prod
    environment:
      - APP_NAME="${APP_NAME:-Image Metadata API}"
      - APP_VERSION=${APP_VERSION:-1.0.0}
      - DEBUG=${DEBUG:-false}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - MAX_FILE_SIZE=${MAX_FILE_SIZE:-10485760}
      - WEBHOOK_URL=${WEBHOOK_URL:-}
      - WEBHOOK_TIMEOUT=${WEBHOOK_TIMEOUT:-10.0}
      - PORT=${PORT:-8345}
    volumes:
      - ./logs:/app/logs
      - ./config:/app/config:ro
    restart: unless-stopped
    healthcheck:
      # usa curl para checar; se sua imagem n√£o tiver curl, veja a nota abaixo
      test: ["CMD-SHELL", "curl -f http://localhost:${PORT:-8345}/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
    networks:
      - ai-regression-api-network

networks:
  ai-regression-api-network:
    driver: bridge
    name: ai-regression-api-network